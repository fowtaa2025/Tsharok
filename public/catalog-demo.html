<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axios Integration Demo - Tsharok</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50">
    
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <i class="fas fa-graduation-cap text-3xl text-indigo-600"></i>
                        <span class="ml-2 text-2xl font-bold text-gray-900">Tsharok</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="catalog.html" class="text-gray-700 hover:text-indigo-600 transition">Back to Catalog</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-code mr-3"></i>Axios Integration Demo
            </h1>
            <p class="text-xl text-indigo-100">Interactive demonstration of advanced AJAX features</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Demo Controls -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            
            <!-- Basic Request -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-bolt text-yellow-500 mr-2"></i>
                    Basic Request
                </h3>
                <p class="text-sm text-gray-600 mb-4">Load courses using standard Axios GET request</p>
                <button onclick="testBasicRequest()" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition">
                    <i class="fas fa-play mr-2"></i>Test Basic Request
                </button>
            </div>

            <!-- Parallel Requests -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-layer-group text-blue-500 mr-2"></i>
                    Parallel Requests
                </h3>
                <p class="text-sm text-gray-600 mb-4">Load multiple resources simultaneously</p>
                <button onclick="testParallelRequests()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-play mr-2"></i>Test Parallel
                </button>
            </div>

            <!-- Cached Request -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-database text-green-500 mr-2"></i>
                    Cached Request
                </h3>
                <p class="text-sm text-gray-600 mb-4">Use cached data for faster loading</p>
                <button onclick="testCachedRequest()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">
                    <i class="fas fa-play mr-2"></i>Test Cache
                </button>
            </div>

            <!-- Request Cancellation -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-times-circle text-red-500 mr-2"></i>
                    Request Cancellation
                </h3>
                <p class="text-sm text-gray-600 mb-4">Cancel ongoing requests</p>
                <div class="space-y-2">
                    <button onclick="testCancellation()" class="w-full bg-orange-600 text-white py-2 rounded-lg hover:bg-orange-700 transition">
                        <i class="fas fa-play mr-2"></i>Start Request
                    </button>
                    <button onclick="cancelRequest()" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">
                        <i class="fas fa-ban mr-2"></i>Cancel
                    </button>
                </div>
            </div>

            <!-- Batch Requests -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-boxes text-purple-500 mr-2"></i>
                    Batch Requests
                </h3>
                <p class="text-sm text-gray-600 mb-4">Load multiple course details at once</p>
                <button onclick="testBatchRequests()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">
                    <i class="fas fa-play mr-2"></i>Test Batch
                </button>
            </div>

            <!-- Search Suggestions -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-search text-teal-500 mr-2"></i>
                    Search Suggestions
                </h3>
                <p class="text-sm text-gray-600 mb-4">Auto-complete search feature</p>
                <input 
                    type="text" 
                    id="search-demo"
                    placeholder="Type to search..."
                    class="w-full px-3 py-2 border rounded-lg mb-2 focus:ring-2 focus:ring-teal-500"
                    oninput="testSearchSuggestions(this.value)"
                >
                <div id="suggestions" class="text-xs text-gray-600"></div>
            </div>

        </div>

        <!-- Performance Stats -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-chart-line text-indigo-600 mr-2"></i>
                Performance Statistics
            </h3>
            <div id="performance-stats" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Total Requests</div>
                    <div class="text-2xl font-bold text-indigo-600">0</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Avg Response Time</div>
                    <div class="text-2xl font-bold text-green-600">0ms</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Success Rate</div>
                    <div class="text-2xl font-bold text-blue-600">100%</div>
                </div>
            </div>
            <button onclick="updateStats()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                <i class="fas fa-sync-alt mr-2"></i>Refresh Stats
            </button>
        </div>

        <!-- Console Output -->
        <div class="bg-gray-900 rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <i class="fas fa-terminal text-green-400 mr-2"></i>
                    Console Output
                </h3>
                <button onclick="clearConsole()" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-trash mr-1"></i>Clear
                </button>
            </div>
            <div id="console-output" class="font-mono text-sm text-green-400 h-64 overflow-y-auto">
                <div class="text-gray-500">// Console output will appear here...</div>
            </div>
        </div>

    </div>

    <script src="assets/js/axios-config.js"></script>
    <script src="assets/js/courses.js"></script>
    <script src="assets/js/catalog-integration.js"></script>
    <script>
        // Console logging
        function logToConsole(message, type = 'info') {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            const icon = {
                info: 'üí°',
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è'
            };
            
            const line = document.createElement('div');
            line.className = `mb-1 ${colors[type]}`;
            line.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${icon[type]} ${message}`;
            
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // Test Functions
        async function testBasicRequest() {
            try {
                logToConsole('Starting basic request...', 'info');
                const startTime = performance.now();
                
                const data = await fetchCourses({ limit: 5 });
                
                const duration = (performance.now() - startTime).toFixed(2);
                logToConsole(`‚ú® Loaded ${data.courses.length} courses in ${duration}ms`, 'success');
                logToConsole(`Total available: ${data.pagination.total}`, 'info');
                
            } catch (error) {
                logToConsole(`Failed: ${error.message}`, 'error');
            }
        }

        async function testParallelRequests() {
            try {
                logToConsole('Starting parallel requests...', 'info');
                const startTime = performance.now();
                
                const result = await loadCatalogDataParallel();
                
                const duration = (performance.now() - startTime).toFixed(2);
                logToConsole(`‚ö° Loaded all data in ${duration}ms`, 'success');
                logToConsole(`Courses: ${result.courses.length}, Majors: ${result.majors.length}`, 'info');
                
            } catch (error) {
                logToConsole(`Failed: ${error.message}`, 'error');
            }
        }

        async function testCachedRequest() {
            try {
                logToConsole('Testing cache...', 'info');
                
                // First request (cache miss)
                const start1 = performance.now();
                await fetchCoursesWithCache({ limit: 5 });
                const duration1 = (performance.now() - start1).toFixed(2);
                logToConsole(`First request: ${duration1}ms (cache miss)`, 'info');
                
                // Second request (cache hit)
                const start2 = performance.now();
                await fetchCoursesWithCache({ limit: 5 });
                const duration2 = (performance.now() - start2).toFixed(2);
                logToConsole(`Second request: ${duration2}ms (cache hit!)`, 'success');
                logToConsole(`Speed improvement: ${((duration1 - duration2) / duration1 * 100).toFixed(0)}%`, 'success');
                
            } catch (error) {
                logToConsole(`Failed: ${error.message}`, 'error');
            }
        }

        let cancelSource = null;

        async function testCancellation() {
            try {
                const CancelToken = axios.CancelToken;
                cancelSource = CancelToken.source();
                
                logToConsole('Starting long request (5 sec delay)...', 'info');
                logToConsole('Click Cancel to abort', 'warning');
                
                await axiosInstance.get('/courses.php', {
                    params: { limit: 50 },
                    cancelToken: cancelSource.token
                });
                
                logToConsole('Request completed', 'success');
                cancelSource = null;
                
            } catch (error) {
                if (axios.isCancel(error)) {
                    logToConsole('Request was cancelled!', 'warning');
                } else {
                    logToConsole(`Failed: ${error.message}`, 'error');
                }
                cancelSource = null;
            }
        }

        function cancelRequest() {
            if (cancelSource) {
                cancelSource.cancel('User cancelled the request');
                logToConsole('Cancellation signal sent', 'info');
            } else {
                logToConsole('No active request to cancel', 'warning');
            }
        }

        async function testBatchRequests() {
            try {
                logToConsole('Loading course IDs first...', 'info');
                const coursesData = await fetchCourses({ limit: 3 });
                
                const courseIds = coursesData.courses.map(c => c.courseId);
                logToConsole(`Found ${courseIds.length} courses: ${courseIds.join(', ')}`, 'info');
                
                logToConsole('Batch loading details...', 'info');
                const result = await batchLoadCourseDetails(courseIds);
                
                logToConsole(`Successfully loaded: ${result.successful.length}`, 'success');
                logToConsole(`Failed: ${result.failed.length}`, result.failed.length > 0 ? 'warning' : 'info');
                
            } catch (error) {
                logToConsole(`Failed: ${error.message}`, 'error');
            }
        }

        let searchTimeout;
        async function testSearchSuggestions(query) {
            clearTimeout(searchTimeout);
            
            const suggestionsDiv = document.getElementById('suggestions');
            
            if (!query || query.length < 2) {
                suggestionsDiv.innerHTML = '';
                return;
            }
            
            suggestionsDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
            
            searchTimeout = setTimeout(async () => {
                try {
                    const suggestions = await searchWithSuggestions(query);
                    
                    if (suggestions.length > 0) {
                        suggestionsDiv.innerHTML = suggestions.map(s => 
                            `<div class="py-1">${s.code} - ${s.name}</div>`
                        ).join('');
                        logToConsole(`Found ${suggestions.length} suggestions for "${query}"`, 'success');
                    } else {
                        suggestionsDiv.innerHTML = 'No suggestions found';
                    }
                    
                } catch (error) {
                    suggestionsDiv.innerHTML = 'Search failed';
                    logToConsole(`Search failed: ${error.message}`, 'error');
                }
            }, 300);
        }

        function updateStats() {
            const stats = catalogPerformanceMonitor.getSummary();
            
            const statsDiv = document.getElementById('performance-stats');
            statsDiv.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Total Requests</div>
                    <div class="text-2xl font-bold text-indigo-600">${stats.totalRequests}</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Avg Response Time</div>
                    <div class="text-2xl font-bold text-green-600">${stats.averageResponseTime}</div>
                </div>
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-sm text-gray-600">Success Rate</div>
                    <div class="text-2xl font-bold text-blue-600">${stats.successRate}</div>
                </div>
            `;
            
            logToConsole('Stats updated: ' + JSON.stringify(stats), 'info');
        }

        // Update stats every 5 seconds
        setInterval(updateStats, 5000);

        // Initial log
        logToConsole('Axios Integration Demo Ready!', 'success');
        logToConsole('Click any button to test features', 'info');
    </script>
</body>
</html>

