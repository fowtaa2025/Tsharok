<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./"> <!-- Fix for Cloudflare Pages routing -->
    <title>Tsharok - Interactive Learning Platform for Students</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/minimalist-design.css">
    <link rel="stylesheet" href="assets/css/design-system.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <link rel="stylesheet" href="assets/css/rtl.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00897b',
                        secondary: '#263238',
                        accent: '#00897b',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Poppins', 'Cairo', sans-serif;
        }

        .hero-content {
            min-height: 80vh;
        }

        .animate-fade-in {
            animation: fadeInModal 0.3s ease-out;
            border-radius: 0;
        }

        @keyframes fadeInModal {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Fix input text color */
        input[type="email"],
        input[type="password"],
        input[type="text"] {
            color: #1f2937 !important;
            border-radius: 0 !important;
        }

        input::placeholder {
            color: #9ca3af !important;
        }

        /* Minimalist buttons */
        button {
            border-radius: 0 !important;
        }
    </style>
</head>

<body class="bg-white overflow-x-hidden">
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html" class="flex items-center">
                        <img src="assets/images/Logo.png" alt="Tsharok Logo" class="h-16">
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#about" class="text-gray-700 hover:text-primary transition font-medium"
                        data-i18n="nav.about">About</a>
                    <button onclick="openAuthModal('register')"
                        class="text-gray-700 hover:text-primary transition font-medium"
                        data-i18n="nav.register">Register</button>
                    <button onclick="openAuthModal('login')"
                        class="text-gray-700 hover:text-primary transition font-medium"
                        data-i18n="nav.login">Login</button>
                    <button onclick="toggleLanguage()" id="languageToggle"
                        class="text-gray-700 hover:text-primary transition font-medium">
                        <span data-i18n="nav.arabic">عربي</span>
                    </button>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <button id="mobileMenuBtn" class="text-gray-700 hover:text-primary focus:outline-none transition">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t slide-in-down">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#about" class="block px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition">About</a>
                <button onclick="openAuthModal('register')"
                    class="block w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition">Register</button>
                <button onclick="openAuthModal('login')"
                    class="block w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition">Login</button>
                <button onclick="toggleLanguage()"
                    class="block w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition">عربي</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-16 hero-content bg-shapes-container">
        <!-- Aesthetic Background Shapes - Various Geometric Designs -->
        <div class="bg-shape bg-circle"></div>
        <div class="bg-shape bg-triangle"></div>
        <div class="bg-shape bg-hexagon"></div>
        <div class="bg-shape bg-diamond"></div>
        <div class="bg-shape bg-rounded-rect"></div>
        <div class="bg-shape bg-star"></div>
        <div class="bg-shape bg-ellipse"></div>
        <div class="bg-shape bg-blob"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 relative z-10">
            <div class="grid md:grid-cols-2 gap-12 items-center min-h-[70vh]">
                <!-- Left Side - Welcome Text -->
                <div class="fade-in-up">
                    <h1 class="text-5xl md:text-6xl font-bold text-gray-900 mb-6 leading-tight">
                        <span data-i18n="Welcome To Tsharok">Welcome To Tsharok</span>
                    </h1>
                    <p class="text-xl md:text-2xl text-gray-600 mb-8"
                        data-i18n="where students share knowledge and learn together">
                        where students share knowledge and learn together
                    </p>
                </div>

                <!-- Right Side - Image -->
                <div class="hidden md:flex items-center justify-center fade-in-right relative">
                    <div class="absolute inset-0 diagonal-lines opacity-30"></div>
                    <div class="relative bg-gray-200 rounded-lg shadow-2xl overflow-hidden w-full max-w-2xl"
                        style="aspect-ratio: 1024/572;">
                        <img src="assets/images/Tsharok.png" alt="Students sharing knowledge and learning together"
                            class="w-full h-full object-cover">
                    </div>
                </div>

                <!-- Mobile Image -->
                <div class="md:hidden flex items-center justify-center fade-in-up">
                    <div class="bg-gray-200 rounded-lg shadow-lg overflow-hidden w-full max-w-sm"
                        style="aspect-ratio: 1024/572;">
                        <img src="assets/images/Tsharok.png" alt="Students sharing knowledge and learning together"
                            class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
        </div>

        <!-- Decorative diagonal lines -->
        <div class="absolute top-0 right-0 w-1/3 h-full diagonal-lines opacity-20 pointer-events-none"></div>
    </section>

    <!-- Authentication Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto relative animate-fade-in">
            <!-- Close Button -->
            <button onclick="closeAuthModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition">
                <i class="fas fa-times text-2xl"></i>
            </button>

            <!-- Modal Content -->
            <div class="p-8">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" id="modalTitle"
                        data-i18n="Log in or create account">Log in or create account</h2>
                    <p class="text-gray-600" data-i18n="Learn on your own time from top universities and businesses">
                        Learn on your own time from top universities and businesses</p>
                </div>

                <!-- Tab Buttons -->
                <div class="flex gap-2 mb-6">
                    <button onclick="switchTab('login')" id="loginTab"
                        class="flex-1 py-2 px-4 rounded-lg font-medium transition">
                        Login
                    </button>
                    <button onclick="switchTab('register')" id="registerTab"
                        class="flex-1 py-2 px-4 rounded-lg font-medium transition">
                        Register
                    </button>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="hidden">
                    <div id="loginMessage" class="hidden mb-4 p-3 rounded-lg"></div>
                    <form id="loginFormElement" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Email <span class="text-red-500">*</span>
                            </label>
                            <input type="email" id="loginEmail" name="email"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="s4XXXXXXXX@uqu.edu.sa" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Password <span class="text-red-500">*</span>
                            </label>
                            <input type="password" id="loginPassword" name="password"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="••••••••" required>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <label class="flex items-center">
                                <input type="checkbox" id="rememberMe"
                                    class="w-4 h-4 text-primary border-gray-300 rounded">
                                <span class="ml-2 text-gray-600">Remember me</span>
                            </label>
                            <a href="forgot-password.html" class="text-primary hover:text-secondary">Forgot
                                password?</a>
                        </div>
                        <button type="submit" id="loginButton"
                            class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-secondary transition">
                            Login
                        </button>
                    </form>

                    <div class="mt-6 text-center text-sm text-gray-600">
                        Don't have an account?
                        <button onclick="switchTab('register')"
                            class="text-primary hover:text-secondary font-medium">Sign up</button>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="hidden">
                    <div id="registerMessage" class="hidden mb-4 p-3 rounded-lg"></div>
                    <form id="registerFormElement" class="space-y-4">
                        <!-- First Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                First Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="registerFirstName" name="first_name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="Ahmed" required>
                        </div>

                        <!-- Last Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Last Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="registerLastName" name="last_name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="Bamarouf" required>
                        </div>

                        <!-- Email (UQU only) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                UQU Email <span class="text-red-500">*</span>
                            </label>
                            <input type="email" id="registerEmail" name="email"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="s4XXXXXXXX@uqu.edu.sa" pattern="[a-zA-Z0-9._%+-]+@uqu\.edu\.sa$"
                                title="Please use your UQU email address (@uqu.edu.sa)" required>
                            <p class="mt-1 text-xs text-gray-500">Must be a valid @uqu.edu.sa email</p>
                        </div>

                        <!-- Password -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Password <span class="text-red-500">*</span>
                            </label>
                            <input type="password" id="registerPassword" name="password"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="••••••••" minlength="8" required>
                            <div class="mt-2 text-xs space-y-1">
                                <p class="font-medium text-gray-700 mb-1">Password must contain:</p>
                                <ul class="space-y-1">
                                    <li id="req-length"
                                        class="flex items-center text-gray-500 transition-all duration-300">
                                        <i class="fas fa-circle text-xs mr-2"></i>
                                        <span>At least 8 characters</span>
                                    </li>
                                    <li id="req-uppercase"
                                        class="flex items-center text-gray-500 transition-all duration-300">
                                        <i class="fas fa-circle text-xs mr-2"></i>
                                        <span>At least one uppercase letter</span>
                                    </li>
                                    <li id="req-lowercase"
                                        class="flex items-center text-gray-500 transition-all duration-300">
                                        <i class="fas fa-circle text-xs mr-2"></i>
                                        <span>At least one lowercase letter</span>
                                    </li>
                                    <li id="req-number"
                                        class="flex items-center text-gray-500 transition-all duration-300">
                                        <i class="fas fa-circle text-xs mr-2"></i>
                                        <span>At least one number</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Confirm Password -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Confirm Password <span class="text-red-500">*</span>
                            </label>
                            <input type="password" id="registerConfirmPassword" name="confirm_password"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                                placeholder="••••••••" required>
                        </div>

                        <button type="submit" id="registerButton"
                            class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-secondary transition">
                            Create Account
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <script src="assets/js/ui-components.js"></script>
    <script src="assets/js/navigation.js"></script>
    <script src="assets/js/page-transitions.js"></script>
    <script src="assets/js/i18n.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/background-styles.js"></script>

    <!-- Auth Modal JavaScript -->
    <script>
        function openAuthModal(tab = 'login') {
            const modal = document.getElementById('authModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
            switchTab(tab);
        }

        function closeAuthModal() {
            const modal = document.getElementById('authModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = 'auto';
            // Clear messages
            document.getElementById('loginMessage').classList.add('hidden');
            document.getElementById('registerMessage').classList.add('hidden');
        }

        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');

            // Hide messages when switching tabs
            document.getElementById('loginMessage').classList.add('hidden');
            document.getElementById('registerMessage').classList.add('hidden');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                loginTab.classList.add('bg-primary', 'text-white');
                loginTab.classList.remove('bg-gray-100', 'text-gray-700');
                registerTab.classList.remove('bg-primary', 'text-white');
                registerTab.classList.add('bg-gray-100', 'text-gray-700');
            } else {
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                registerTab.classList.add('bg-primary', 'text-white');
                registerTab.classList.remove('bg-gray-100', 'text-gray-700');
                loginTab.classList.remove('bg-primary', 'text-white');
                loginTab.classList.add('bg-gray-100', 'text-gray-700');
            }
        }

        function showMessage(elementId, message, isError = false) {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = message;
            messageEl.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            if (isError) {
                messageEl.classList.add('bg-red-100', 'text-red-700');
            } else {
                messageEl.classList.add('bg-green-100', 'text-green-700');
            }
        }

        // Handle Login Form Submission
        document.getElementById('loginFormElement')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const button = document.getElementById('loginButton');

            button.disabled = true;
            button.textContent = 'Logging in...';

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success && data.user) {
                    // Store in sessionStorage (isolated per tab)
                    sessionStorage.setItem('user', JSON.stringify(data.user));
                    sessionStorage.setItem('token', data.user.sessionToken || '');
                    localStorage.setItem('isLoggedIn', 'true');

                    showMessage('loginMessage', 'Login successful! Redirecting...', false);

                    setTimeout(() => {
                        // Redirect based on role
                        if (data.user.role === 'admin') {
                            window.location.href = 'dashboard/admin.html';
                        } else {
                            window.location.href = 'dashboard/student.html';
                        }
                    }, 1500);
                } else {
                    showMessage('loginMessage', data.error || 'Login failed. Please try again.', true);
                    button.disabled = false;
                    button.textContent = 'Login';
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('loginMessage', 'An error occurred. Please try again.', true);
                button.disabled = false;
                button.textContent = 'Login';
            }
        });

        // Handle Register Form Submission
        document.getElementById('registerFormElement')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const button = document.getElementById('registerButton');

            button.disabled = true;
            button.textContent = 'Creating account...';

            try {
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'register',
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showMessage('registerMessage', 'Registration successful! You can now log in.', false);
                    setTimeout(() => {
                        switchTab('login');
                        document.getElementById('loginEmail').value = email;
                    }, 2000);
                } else {
                    showMessage('registerMessage', data.error || 'Registration failed. Please try again.', true);
                    button.disabled = false;
                    button.textContent = 'Create Account';
                }
            } catch (error) {
                showMessage('registerMessage', 'An error occurred. Please try again.', true);
                button.disabled = false;
                button.textContent = 'Create Account';
            }
        });

        // Close modal when clicking outside
        document.getElementById('authModal')?.addEventListener('click', function (e) {
            if (e.target === this) {
                closeAuthModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeAuthModal();
            }
        });

        // Password validation with animated feedback
        document.getElementById('registerPassword')?.addEventListener('input', function (e) {
            const password = e.target.value;

            // Check each requirement
            const hasLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);

            // Update UI for each requirement
            updateRequirement('req-length', hasLength);
            updateRequirement('req-uppercase', hasUppercase);
            updateRequirement('req-lowercase', hasLowercase);
            updateRequirement('req-number', hasNumber);
        });

        function updateRequirement(id, isMet) {
            const element = document.getElementById(id);
            if (!element) return;

            const icon = element.querySelector('i');

            if (isMet) {
                element.classList.remove('text-gray-500');
                element.classList.add('text-green-600');
                icon.classList.remove('fa-circle');
                icon.classList.add('fa-check-circle');
            } else {
                element.classList.remove('text-green-600');
                element.classList.add('text-gray-500');
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-circle');
            }
        }

        // Check if redirected from protected page and auto-open login modal
        window.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('redirect')) {
                // Auto-open login modal if redirected
                openAuthModal('login');
            }
        });
    </script>
</body>

</html>