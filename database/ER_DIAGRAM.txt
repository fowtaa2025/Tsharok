Tsharok Database - Entity Relationship Diagram (Text Format)
============================================================

ENTITIES & ATTRIBUTES
=====================

┌─────────────────────┐
│      MAJORS         │
├─────────────────────┤
│ PK: id              │
│     name            │
│     description     │
│     created_at      │
│     updated_at      │
└─────────────────────┘
         │
         │ 1
         │
         │ N
┌─────────────────────┐
│      USERS          │
├─────────────────────┤
│ PK: user_id         │
│     username        │
│     email           │
│     password_hash   │
│     first_name      │
│     last_name       │
│     role            │
│ FK: major_id        │
│     phone           │
│     profile_image   │
│     bio             │
│     is_active       │
│     created_at      │
│     updated_at      │
│     last_login      │
└─────────────────────┘
    │         │
    │ 1       │ 1
    │         │
    │ N       │ N
┌─────────┐  ┌──────────────┐
│ COURSES │  │ ENROLLMENTS  │
├─────────┤  ├──────────────┤
│...      │  │ PK: enroll_id│
└─────────┘  │ FK: student_id│
    │        │ FK: course_id │
    │        │     status    │
    │        │     progress% │
    │ 1      │     grade     │
    │        └───────────────┘
    │ N
┌─────────────────────┐
│      CONTENT        │
├─────────────────────┤
│ PK: id              │
│     title           │
│     type            │
│     file_url        │
│     upload_date     │
│ FK: uploader_id     │
│ FK: course_id       │
│     is_approved     │
│     description     │
│     file_size       │
│     mime_type       │
└─────────────────────┘
    │         │         │
    │ 1       │ 1       │ 1
    │         │         │
    │ N       │ N       │ N
┌────────┐ ┌─────────┐ ┌──────────┐
│RATINGS │ │COMMENTS │ │DOWNLOADS │
├────────┤ ├─────────┤ ├──────────┤
│PK: id  │ │PK: id   │ │PK: id    │
│FK:usr_id│ │FK:cnt_id│ │FK:usr_id │
│FK:cnt_id│ │FK:usr_id│ │FK:cnt_id │
│  score │ │ content │ │download_at│
└────────┘ └─────────┘ └──────────┘


┌─────────────────────┐
│   ADMIN_ACTIONS     │
├─────────────────────┤
│ PK: id              │
│ FK: admin_id        │
│     action_type     │
│     target_type     │
│     target_id       │
│     timestamp       │
│     description     │
└─────────────────────┘
         │
         │ N
         │
         │ 1
    (to USERS)


RELATIONSHIPS SUMMARY
=====================

1. MAJORS (1) ──< (N) USERS
   - One major can have many users
   - A user belongs to zero or one major

2. USERS (1 as Instructor) ──< (N) COURSES
   - One instructor can teach many courses
   - Each course has one instructor

3. USERS (N as Student) ──< >── (N) COURSES
   - Many students can enroll in many courses
   - Resolved through ENROLLMENTS table

4. COURSES (1) ──< (N) CONTENT
   - One course can have many content items
   - Each content belongs to one course

5. USERS (1 as Uploader) ──< (N) CONTENT
   - One user can upload many content items
   - Each content has one uploader

6. USERS (1) ──< (N) RATINGS
   - One user can give many ratings
   - Each rating is from one user

7. CONTENT (1) ──< (N) RATINGS
   - One content can have many ratings
   - Each rating is for one content
   - UNIQUE: One user can rate one content only once

8. USERS (1) ──< (N) COMMENTS
   - One user can write many comments
   - Each comment is from one user

9. CONTENT (1) ──< (N) COMMENTS
   - One content can have many comments
   - Each comment is on one content

10. USERS (1) ──< (N) DOWNLOADS
    - One user can download many items
    - Each download is by one user

11. CONTENT (1) ──< (N) DOWNLOADS
    - One content can be downloaded many times
    - Each download is of one content

12. USERS (1 as Admin) ──< (N) ADMIN_ACTIONS
    - One admin can perform many actions
    - Each action is performed by one admin


CARDINALITIES
=============

Relationship                  Type      Description
─────────────────────────────────────────────────────────────
Majors → Users               1:N       One-to-Many
Users → Courses (Instructor) 1:N       One-to-Many
Users ↔ Courses (Student)    N:N       Many-to-Many (via Enrollments)
Courses → Content            1:N       One-to-Many
Users → Content (Uploader)   1:N       One-to-Many
Users → Ratings              1:N       One-to-Many
Content → Ratings            1:N       One-to-Many
Users → Comments             1:N       One-to-Many
Content → Comments           1:N       One-to-Many
Users → Downloads            1:N       One-to-Many
Content → Downloads          1:N       One-to-Many
Users → AdminActions         1:N       One-to-Many


CONSTRAINTS & RULES
===================

UNIQUE Constraints:
- users.username
- users.email
- courses.course_code
- enrollments (student_id, course_id)
- ratings (user_id, content_id)

CHECK Constraints:
- ratings.score BETWEEN 0 AND 5

ENUM Constraints:
- users.role: 'student', 'instructor', 'admin'
- courses.level: 'beginner', 'intermediate', 'advanced'
- enrollments.status: 'active', 'completed', 'dropped', 'suspended'
- content.type: 'lecture', 'assignment', 'video', 'document', 'quiz', 'other'
- admin_actions.action_type: 'create', 'update', 'delete', 'approve', 'reject', 'ban', 'unban', 'other'
- admin_actions.target_type: 'user', 'course', 'content', 'comment', 'other'

Foreign Key Actions:
- ON DELETE CASCADE: Most relationships (data cleanup)
- ON DELETE RESTRICT: courses.instructor_id (prevent instructor deletion)
- ON DELETE SET NULL: users.major_id (allow major deletion)


BUSINESS RULES
==============

1. A user cannot enroll in the same course twice
2. A user can rate a content item only once
3. Only instructors can be assigned to courses
4. Only students can enroll in courses
5. Only admins can perform admin actions
6. Content must be approved before being widely accessible
7. Ratings must be between 0 and 5
8. Course codes must be unique
9. Usernames and emails must be unique
10. Instructors cannot be deleted if they have active courses


DATA FLOW EXAMPLES
==================

Student Workflow:
1. User registers → INSERT INTO users
2. Selects major → UPDATE users SET major_id
3. Enrolls in course → INSERT INTO enrollments
4. Downloads content → INSERT INTO downloads
5. Rates content → INSERT INTO ratings
6. Comments on content → INSERT INTO comments
7. Completes course → UPDATE enrollments SET status='completed', grade

Instructor Workflow:
1. Creates course → INSERT INTO courses
2. Uploads content → INSERT INTO content (is_approved=FALSE)
3. Admin approves → UPDATE content SET is_approved=TRUE
4. Views student progress → SELECT FROM enrollments
5. Grades students → UPDATE enrollments SET grade

Admin Workflow:
1. Approves content → UPDATE content + INSERT INTO admin_actions
2. Manages users → UPDATE users + INSERT INTO admin_actions
3. Reviews actions → SELECT FROM admin_actions
4. Monitors system → Various SELECT queries

